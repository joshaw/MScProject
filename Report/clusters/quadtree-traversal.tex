% Created:  Thu 10 Jul 2014 04:22 PM
% Modified: Tue 22 Jul 2014 04:29 PM
% @author Josh Wainwright
% File name : quadtree-traversal.tex

\section{Quadtree Traversal}
\label{sec:quadtree_traversal}

Whether the quadtree is stored in memory as a recursive quadtree data
structure, or as hash table, Section~\ref{sub:hash_table_implementation}, the
most important and computationally intensive step is extracting the clusters at
the correct depth and disregarding those data points that can be attributed to
noise.

The quadtree numbering system chosen lends itself very well to analysis based
on spatial location and the proximity of neighbours to a given node being
examined. The neighbours of interest, named \emph{rook's case} neighbours
by~\cite{abel1990comparative}, are the four nodes that lie to the north, east,
sound and west of the current node.

The propagation algorithm is performed as follows:
\begin{enumerate}
	\item Choose a starting location that has not yet been checked.
	\item For this given starting location, the four neighbours are checked for
		validity based on the conditions of the analysis.
	\item If a node fails the check, then it is recorded as having done so and
		shall not be checked again. If it passes, then it is itself propagated.
		\begin{itemize}
			\item To be ``propagated'' means the perform this propagation
				algorithm using that node as the starting location.
		\end{itemize}
	\item When all nodes have been checked, return to step 1.
	\item The algorithm completes either when either;
	\begin{itemize}
		\item every one of the nodes in the image have been checked and
			included or ignored, or
		\item the cluster has ended, so all the neighbours of all checked nodes
			have failed the validity tests and no further starting locations
			were found or specified.
	\end{itemize}
\end{enumerate}

This process is shown graphically in Figure~\ref{fig:propogation}. Here, and
from now on, blue nodes are nodes that either need to be checked or are
currently being checked; red are nodes that have been checked and have been
included in the cluster; question marks ({\footnotesize?}) represent the
neighbours of the blue nodes that will have to be checked to determine if it is
included or not and crosses ({\footnotesize x}) represent neighbours that have
been checked and excluded.

\begin{figure}[tbhp]
	\centering
	\includegraphics[width=0.88\linewidth]{propogation.pdf}
	\caption{For a starting location, a), in an image, no information is known
	and so the neighbours are checked. Some of these are found to be part of
	the cluster, others are rejected. The ones that are included are then,
	themselves, checked and so on. As the cluster grows, b), c) and d), the
	number of checked nodes increases.}
	\label{fig:propogation}
\end{figure}

When discovering clusters via this propagation technique, care must be taken to
avoid a run-away situation where every node in the tree gets included. This
would happen when looking at the neighbours of a node and blindly including
them. Since every internal node has exactly four neighbours, the propagation
would terminate only when reaching the edge nodes.

Instead, the depth of the node must be considered. Again, the simplest method
is not sufficient. If the propagation is limited to a given node depth, even if
this is not the same as the deepest node, the size of any clusters that are
identified will be limited, as shown in Figure~\ref{fig:propogation-halting}.
Since the depth to consider is not able to change, when the neighbours of the
blue node are checked, no correct neighbours are found and so the process
terminates. When able to view the larger structure of the nodes, however, it is
clear that the structure continues beyond the gap.

\begin{figure}[tbhp]
	\centering
	\includegraphics[width=0.7\linewidth]{propogation-halting.pdf}
	\caption{propogation-Halting}
	\label{fig:propogation-halting}
\end{figure}

To avoid this, a certain amount of leniency must be given when deciding what
constitutes a neighbour. Given an appropriate value, this would allow both of
the larger white cells in Figure~\ref{fig:propogation-halting} to be included.

The \emph{depth range} shall define the levels that are to be considered when
choosing neighbours with respect to a target depth. Since clusters are being
considered as areas of increased density of points, all cells with a depth
greater than the target depth shall be allowed, so the purple cells in
Figure~\ref{fig:propogation-halting} would be included when the target depth is
the same as the depth of the included red cells. A depth range of zero is
eqivalent to the situation above where only cells of a given depth are
considered. A depth range of 1 would mean that the white square in
Figure~\ref{fig:propogation-levels}\,b) would be included but not in~c),
whereas a depth range of three would include both and so on.

%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%
%

\section{Clustering Algorithm}
\label{sec:clustering_algorithm}

\begin{figure}[tbhp]
	\centering
	\begin{subfigure}[c]{0.48\linewidth}
		\includegraphics[width=\textwidth]{single-cluster.png}
		\caption{}\label{fig:single-cluster-points}
	\end{subfigure}%
	\quad
	\begin{subfigure}[c]{0.48\linewidth}
		\includegraphics[width=\textwidth]{single-cluster-lines.png}
		\caption{}\label{fig:single-cluster-lines}
	\end{subfigure}
	% TODO caption
	\caption{} \label{fig:single-cluster}
\end{figure}

\begin{figure}[tbhp]
	\begin{minipage}[c]{0.80\linewidth}
		\centering
		\fbox{\includegraphics[width=\textwidth]{multiple-clusters-colours.png}}
	\end{minipage}%
	\begin{minipage}[c]{0.1\linewidth}
		\centering
		\begin{tabular}[b]{ l l }
			\cellcolor[HTML]{FCE94F}1\\
			\cellcolor[HTML]{FCAF3E}2\\
			\cellcolor[HTML]{E9B96E}3\\
			\cellcolor[HTML]{8AE234}4\\
			\cellcolor[HTML]{729FCF}5\\
			\cellcolor[HTML]{AD7FA8}6\\
			\cellcolor[HTML]{EF2929}7\\
			\cellcolor[HTML]{D3D7CF}8\\
			\cellcolor[HTML]{888A85}9\\
		\end{tabular}
	\end{minipage}
	% TODO caption
	\caption{Bla bla}
	\label{fig:multiple-clusters-colours.png}
\end{figure}
